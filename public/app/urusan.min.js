const urusanUrl=window.location.origin+"/organisasi/urusan/",bidangUrl=window.location.origin+"/organisasi/bidang/",unitUrl=window.location.origin+"/organisasi/unit/",subUnitUrl=window.location.origin+"/organisasi/subunit/";var user={};const confirmDelete={title:"Apakah Anda yakin?",text:"Data yang telah dihapus tidak dapat dikembalikan!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, hapus sekarang!",cancelButtonText:"Tidak, batal hapus!",reverseButtons:!0};var urusan={},bidang={},unit={};function successSwal(a){return Swal.fire("Berhasil!",a,"success")}function showError(a,t){$.each(a,function(a,n){$("#"+t).find($("input[name="+a+"]")).addClass("is-invalid"),$("#"+t).find($("#"+a+"_feedback")).text(n)})}function editUrusan(a){$("#modalFormUrusan").text("Form Ubah Urusan"),$("#btnSimpanUrusan").hide(),$("#btnSimpanUbahUrusan").show(),$("#formUrusan").trigger("reset"),$.ajax({type:"GET",url:urusanUrl+"show/"+a,dataType:"json",success:function(a){$("#kodeUrusan").val(a.data.kode),$("#namaUrusan").val(a.data.nama_urusan),$("#urusanId").remove(),$("#formUrusan").append('<input type="hidden" name="urusan_id" id="urusanId" value="'+a.data.id+'"/>')}}),$("#modalUrusan").modal("show")}function updateUrusan(a){a.preventDefault(),$.ajax({type:"PUT",url:urusanUrl+"update/"+$("#urusanId").val(),dataType:"json",data:$("#formUrusan").serialize(),success:function(a){a.status?($("#modalUrusan").modal("hide"),$.ajax({type:"GET",url:urusanUrl+"show/"+$("#urusanId").val(),dataType:"json",success:function(a){$("#rowKode"+a.data.id).text(a.data.kode),$("#rowNama"+a.data.id).text(a.data.nama_urusan)}}),successSwal("Berhasil mengubah data urusan.")):showError(a.error,"formUrusan")}})}function deleteUrusan(a){var t=$("#btnDeleteUrusan"+a).data("delete-url");Swal.fire(confirmDelete).then(n=>{n.value&&$.ajax({type:"GET",url:t,dataType:"json",success:function(t){successSwal("Data urusan telah dihapus."),$("#rowUrusan"+a).remove()}})})}function goToBidangTab(a){$("#content-urusan-tab").removeClass("active"),$("#urusan").removeClass(["active show"]),$("#content-bidang-tab").addClass("active"),$("#bidang").addClass("active show"),getDataBidang(a)}function getDataBidang(a){var t="";$("#btnTambahBidang").show(),$("#tableBidang").hide(),$("#noDataBidang").hide(),$("#bidangLoader").append('<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>'),$.ajax({type:"GET",url:bidangUrl+"by-urusan/"+a,dataType:"json",success:function(n){if($("#tableBidangBody").html(""),t="",n.data.length>0){urusan=n.data[0].urusan;for(var d=0;d<n.data.length;d++)t+='<tr id="rowBidang'+n.data[d].id+'">',t+="<td>"+n.data[d].urusan.kode+"</td>",t+='<td id="rowKodeBidang'+n.data[d].id+'">'+n.data[d].kode+"</td>",t+='<td><a href="#" id="rowNamaBidang'+n.data[d].id+'" onclick="goToUnitTab(\''+n.data[d].id+"')\">"+n.data[d].nama_bidang+"</a></td>","superadmin"===user.role&&(t+="<td>",t+='<button class="btn btn-xs btn-outline-warning" onclick="editBidang(\''+n.data[d].id+'\')" id="btnEditBidang'+n.data[d].id+'" data-update-url="" data-bidang-id="'+n.data[d].id+'"><i class="fa fa-edit"></i></button> ',t+='<button class="btn btn-xs btn-outline-danger" id="btnDeleteBidang'+n.data[d].id+'" data-delete-url="'+bidangUrl+"delete/"+n.data[d].id+'" data-bidang-id="'+n.data[d].id+'" onclick="deleteBidang('+n.data[d].id+')"> <i class="fa fa-trash"></i></button>',t+="</td>"),t+="</tr>";$("#bidangLoader").html(""),$("#tableBidang").show(),$("#tableBidangBody").html(t)}else $("#noDataBidang").show(),$.ajax({type:"GET",url:urusanUrl+"show/"+a,dataType:"json",success:function(a){urusan=a.data}}),$("#bidangLoader").html("")}})}function editBidang(a){$("#modalFormBidang").text("Form Ubah Bidang"),$("#btnSimpanBidang").hide(),$("#btnSimpanUbahBidang").show(),$("#formBidang").trigger("reset"),$.ajax({type:"GET",url:bidangUrl+"show/"+a,dataType:"json",success:function(a){$("#urusanId").val(urusan.id),$("#urusanBidang").val(urusan.kode+"..."+urusan.nama_urusan),$("#kodeBidang").val(a.data.kode),$("#namaBidang").val(a.data.nama_bidang),$("#bidangId").remove(),$("#formBidang").append('<input type="hidden" name="bidang_id" id="bidangId" value="'+a.data.id+'"/>')}}),$("#modalBidang").modal("show")}function updateBidang(a){a.preventDefault(),$.ajax({type:"PUT",url:bidangUrl+"update/"+$("#bidangId").val(),dataType:"json",data:$("#formBidang").serialize(),success:function(a){a.status?($("#modalBidang").modal("hide"),$.ajax({type:"GET",url:bidangUrl+"show/"+$("#bidangId").val(),dataType:"json",success:function(a){console.log(a),$("#rowKodeBidang"+a.data.id).text(a.data.kode),$("#rowNamaBidang"+a.data.id).text(a.data.nama_bidang)}}),successSwal("Berhasil mengubah data urusan.")):showError(a.error,"formUrusan")}})}function deleteBidang(a){var t=$("#btnDeleteBidang"+a).data("delete-url");Swal.fire(confirmDelete).then(n=>{n.value&&$.ajax({type:"GET",url:t,dataType:"json",success:function(t){successSwal("Berhasil menghapus data bidang"),$("#rowBidang"+a).remove()}})})}function goToUnitTab(a){$("#content-bidang-tab").removeClass("active"),$("#bidang").removeClass(["active show"]),$("#content-unit-tab").addClass("active"),$("#unit").addClass("active show"),getDataUnit(a)}function getDataUnit(a){var t="";$("#btnTambahUnit").show(),$("#tableUnit").hide(),$("#noDataUnit").hide(),$("#unitLoader").append('<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>'),$.ajax({type:"GET",url:unitUrl+"by-bidang/"+a,dataType:"json",success:function(n){if($("#tableUnitBody").html(""),t="",n.data.length>0){bidang=n.data[0].bidang;for(var d=0;d<n.data.length;d++)t+='<tr id="rowUnit'+n.data[d].id+'">',t+="<td>"+bidang.urusan.kode+"</td>",t+="<td>"+bidang.kode+"</td>",t+='<td id="rowKodeUnit'+n.data[d].id+'">'+n.data[d].kode+"</td>",t+='<td><a href="#" id="rowNamaUnit'+n.data[d].id+'" onclick="goToSubUnitTab(\''+n.data[d].id+"')\">"+n.data[d].nama_unit+"</a></td>","superadmin"===user.role&&(t+="<td>",t+='<button class="btn btn-xs btn-outline-warning" onclick="editUnit(\''+n.data[d].id+'\')" id="btnEditUnit'+n.data[d].id+'" data-update-url="" data-unit-id="'+n.data[d].id+'"><i class="fa fa-edit"></i></button> ',t+='<button class="btn btn-xs btn-outline-danger" id="btnDeleteUnit'+n.data[d].id+'" data-delete-url="'+unitUrl+"delete/"+n.data[d].id+'" data-unit-id="'+n.data[d].id+'" onclick="deleteUnit('+n.data[d].id+')"> <i class="fa fa-trash"></i></button>',t+="</td>"),t+="</tr>";$("#unitLoader").html(""),$("#tableUnit").show(),$("#tableUnitBody").html(t)}else $("#noDataUnit").show(),$.ajax({type:"GET",url:bidangUrl+"show/"+a,dataType:"json",success:function(a){bidang=a.data,urusan=a.data.urusan}}),$("#unitLoader").html("")}})}function editUnit(a){$("#modalFormUnit").text("Form Ubah Unit"),$("#btnSimpanUnit").hide(),$("#btnSimpanUbahUnit").show(),$("#formUnit").trigger("reset"),$.ajax({type:"GET",url:unitUrl+"show/"+a,dataType:"json",success:function(a){$("#bidangId").val(bidang.id),$("#bidangUnit").val(bidang.kode+"..."+bidang.nama_bidang),$("#kodeUnit").val(a.data.kode),$("#namaUnit").val(a.data.nama_unit),$("#unitId").remove(),$("#formUnit").append('<input type="hidden" name="unit_id" id="unitId" value="'+a.data.id+'"/>')}}),$("#modalUnit").modal("show")}function updateUnit(a){a.preventDefault(),$.ajax({type:"PUT",url:unitUrl+"update/"+$("#unitId").val(),dataType:"json",data:$("#formUnit").serialize(),success:function(a){a.status?($("#modalUnit").modal("hide"),$.ajax({type:"GET",url:unitUrl+"show/"+$("#unitId").val(),dataType:"json",success:function(a){$("#rowKodeUnit"+a.data.id).text(a.data.kode),$("#rowNamaUnit"+a.data.id).text(a.data.nama_unit)}}),successSwal("Berhasil mengubah data unit.")):showError(a.error,"formUnit")}})}function deleteUnit(a){var t=$("#btnDeleteUnit"+a).data("delete-url");Swal.fire(confirmDelete).then(n=>{n.value&&$.ajax({type:"GET",url:t,dataType:"json",success:function(t){successSwal("Berhasil menghapus data unit"),$("#rowUnit"+a).remove()}})})}function goToSubUnitTab(a){$("#content-unit-tab").removeClass("active"),$("#unit").removeClass(["active show"]),$("#content-subunit-tab").addClass("active"),$("#subunit").addClass("active show"),getDataSubUnit(a)}function getDataSubUnit(a){var t="";$("#btnTambahSubUnit").show(),$("#tableSubUnit").hide(),$("#noDataSubUnit").hide(),$("#subUnitLoader").append('<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>'),$.ajax({type:"GET",url:subUnitUrl+"by-unit/"+a,dataType:"json",success:function(n){if($("#tableSubUnitBody").html(""),t="",n.data.length>0){unit=n.data[0].unit,bidang=n.data[0].unit.bidang,urusan=n.data[0].unit.bidang.urusan;for(var d=0;d<n.data.length;d++)t+='<tr id="rowSubUnit'+n.data[d].id+'">',t+="<td>"+urusan.kode+"</td>",t+="<td>"+bidang.kode+"</td>",t+="<td>"+unit.kode+"</td>",t+='<td id="rowKodeSubUnit'+n.data[d].id+'">'+n.data[d].kode+"</td>",t+='<td id="rowNamaSubUnit'+n.data[d].id+'">'+n.data[d].nama_sub_unit+"</td>","superadmin"===user.role&&(t+="<td>",t+='<button class="btn btn-xs btn-outline-warning" onclick="editSubUnit(\''+n.data[d].id+'\')" id="btnEditSubUnit'+n.data[d].id+'" data-update-url="" data-unit-id="'+n.data[d].id+'"><i class="fa fa-edit"></i></button> ',t+='<button class="btn btn-xs btn-outline-danger" id="btnDeleteSubUnit'+n.data[d].id+'" data-delete-url="'+subUnitUrl+"delete/"+n.data[d].id+'" data-unit-id="'+n.data[d].id+'" onclick="deleteSubUnit('+n.data[d].id+')"> <i class="fa fa-trash"></i></button>',t+="</td>"),t+="</tr>";$("#subUnitLoader").html(""),$("#tableSubUnit").show(),$("#tableSubUnitBody").html(t)}else $("#noDataSubUnit").show(),$.ajax({type:"GET",url:unitUrl+"show/"+a,dataType:"json",success:function(a){unit=a.data,bidang=a.data.bidang,urusan=a.data.bidang.urusan}}),$("#subUnitLoader").html("")}})}function editSubUnit(a){$("#modalFormSubUnit").text("Form Ubah Sub Unit"),$("#btnSimpanSubUnit").hide(),$("#btnSimpanUbahSubUnit").show(),$("#formSubUnit").trigger("reset"),$.ajax({type:"GET",url:subUnitUrl+"show/"+a,dataType:"json",success:function(a){$("#unitId").val(unit.id),$("#unitSubUnit").val(unit.kode+"..."+unit.nama_unit),$("#kodeSubUnit").val(a.data.kode),$("#namaSubUnit").val(a.data.nama_sub_unit),$("#subUnitId").remove(),$("#formSubUnit").append('<input type="hidden" name="sub_unit_id" id="subUnitId" value="'+a.data.id+'"/>')}}),$("#modalSubUnit").modal("show")}function updateSubUnit(a){a.preventDefault(),$.ajax({type:"PUT",url:subUnitUrl+"update/"+$("#subUnitId").val(),dataType:"json",data:$("#formSubUnit").serialize(),success:function(a){a.status?($("#modalSubUnit").modal("hide"),$.ajax({type:"GET",url:subUnitUrl+"show/"+$("#subUnitId").val(),dataType:"json",success:function(a){$("#rowKodeSubUnit"+a.data.id).text(a.data.kode),$("#rowNamaSubUnit"+a.data.id).text(a.data.nama_sub_unit)}}),successSwal("Berhasil mengubah data sub unit.")):showError(a.error,"formSubUnit")}})}function deleteSubUnit(a){var t=$("#btnDeleteSubUnit"+a).data("delete-url");Swal.fire(confirmDelete).then(n=>{n.value&&$.ajax({type:"GET",url:t,dataType:"json",success:function(t){successSwal("Berhasil menghapus data unit"),$("#rowSubUnit"+a).remove()}})})}$(function(){Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3});$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$.ajax({type:"GET",url:window.location.origin+"/user-info",success:function(a){user=a}}),$("#btnTambahUrusan").on("click",function(a){a.preventDefault(),$("#modalFormUrusan").text("Form Tambah Urusan"),$("#btnSimpanUrusan").show(),$("#btnSimpanUbahUrusan").hide(),$("#formUrusan").trigger("reset"),$("#modalUrusan").modal("show")}),$("#btnSimpanUrusan").on("click",function(a){a.preventDefault();var t="";$.ajax({type:"POST",url:urusanUrl+"store",dataType:"json",data:$("#formUrusan").serialize(),success:function(a){a.status?(t="",t='<tr id="rowUrusan'+a.data.id+'"><td id="rowKode'+a.data.id+'">'+a.data.kode+'</td><td><a href="#" id="rowNama'+a.data.id+'" onclick="goToBidangTab(\''+a.data.id+"')\">"+a.data.nama_urusan+'</a></td><td><button class="btn btn-xs btn-outline-warning" onclick="editUrusan(\''+a.data.id+'\')" data-update-url="'+urusanUrl+"show/"+a.data.id+'" data-urusan-id="'+a.data.id+'"><i class="fa fa-edit"></i></button> <button class="btn btn-xs btn-outline-danger" id="btnDeleteUrusan'+a.data.id+'" onclick="deleteUrusan('+a.data.id+')" data-delete-url="'+urusanUrl+"delete/"+a.data.id+'" data-urusan-id="'+a.data.id+'"><i class="fa fa-trash"></i></button></td></tr>',$("#tableUrusan").prepend(t),successSwal("Berhasil menambah data urusan."),$("#modalUrusan").modal("hide")):showError(a.error,"formUrusan")}})}),$("#btnTambahBidang").on("click",function(a){a.preventDefault(),$("#modalFormBidang").text("Form Tambah Bidang"),$("#btnSimpanBidang").show(),$("#btnSimpanUbahBidang").hide(),$("#formBidang").trigger("reset"),$("#modalBidang").modal("show"),$("#urusanId").val(urusan.id),$("#urusanBidang").val(urusan.kode+"..."+urusan.nama_urusan)}),$("#btnSimpanBidang").on("click",function(a){a.preventDefault();var t="";$.ajax({type:"POST",url:bidangUrl+"store",dataType:"json",data:$("#formBidang").serialize(),success:function(a){a.status?($("#noDataBidang").hide(),$("#tableBidang").show(),t="",t+='<tr id="rowBidang'+a.data.id+'">',t+="<td>"+urusan.kode+"</td>",t+='<td id="rowKodeBidang'+a.data.id+'">'+a.data.kode+"</td>",t+='<td><a href="#" id="rowNamaBidang'+a.data.id+'" onclick="goToUnitTab(\''+a.data.id+"')\">"+a.data.nama_bidang+"</a></td>","superadmin"===user.role&&(t+="<td>",t+='<button class="btn btn-xs btn-outline-warning" onclick="editBidang(\''+a.data.id+'\')" id="btnEditBidang'+a.data.id+'" data-update-url="" data-bidang-id="'+a.data.id+'"><i class="fa fa-edit"></i></button> ',t+='<button class="btn btn-xs btn-outline-danger" id="btnDeleteBidang'+a.data.id+'" data-delete-url="'+bidangUrl+"delete/"+a.data.id+'" data-bidang-id="'+a.data.id+'" onclick="deleteBidang('+a.data.id+')"> <i class="fa fa-trash"></i></button>',t+="</td>"),t+="</tr>",$("#tableBidangBody").prepend(t),successSwal("Berhasil menambah data bidang."),$("#modalBidang").modal("hide")):showError(a.error,"formBidang")}})}),$("#btnTambahUnit").on("click",function(a){a.preventDefault(),$("#modalFormUnit").text("Form Tambah Unit"),$("#btnSimpanUnit").show(),$("#btnSimpanUbahUnit").hide(),$("#formUnit").trigger("reset"),$("#modalUnit").modal("show"),$("#bidangId").val(bidang.id),$("#bidangUnit").val(bidang.kode+"..."+bidang.nama_bidang)}),$("#btnSimpanUnit").on("click",function(a){a.preventDefault();var t="";$.ajax({type:"POST",url:unitUrl+"store",dataType:"json",data:$("#formUnit").serialize(),success:function(a){a.status?($("#noDataUnit").hide(),$("#tableUnit").show(),t="",t+='<tr id="rowUnit'+a.data.id+'">',t+="<td>"+urusan.kode+"</td>",t+="<td>"+bidang.kode+"</td>",t+='<td id="rowKodeUnit'+a.data.id+'">'+a.data.kode+"</td>",t+='<td><a href="#" id="rowNamaUnit'+a.data.id+'" onclick="goToSubUnitTab(\''+a.data.id+"')\">"+a.data.nama_unit+"</a></td>","superadmin"===user.role&&(t+="<td>",t+='<button class="btn btn-xs btn-outline-warning" onclick="editUnit(\''+a.data.id+'\')" id="btnEditUnit'+a.data.id+'" data-update-url="" data-unit-id="'+a.data.id+'"><i class="fa fa-edit"></i></button> ',t+='<button class="btn btn-xs btn-outline-danger" id="btnDeleteUnit'+a.data.id+'" data-delete-url="'+unitUrl+"delete/"+a.data.id+'" data-unit-id="'+a.data.id+'" onclick="deleteUnit('+a.data.id+')"> <i class="fa fa-trash"></i></button>',t+="</td>"),t+="</tr>",$("#tableUnitBody").prepend(t),successSwal("Berhasil menambah data unit."),$("#modalUnit").modal("hide")):showError(a.error,"formUnit")}})}),$("#btnTambahSubUnit").on("click",function(a){a.preventDefault(),$("#modalFormSubUnit").text("Form Tambah Sub Unit"),$("#btnSimpanSubUnit").show(),$("#btnSimpanUbahSubUnit").hide(),$("#formSubUnit").trigger("reset"),$("#modalSubUnit").modal("show"),$("#unitId").val(unit.id),$("#unitSubUnit").val(unit.kode+"..."+unit.nama_unit)}),$("#btnSimpanSubUnit").on("click",function(a){a.preventDefault();var t="";$.ajax({type:"POST",url:subUnitUrl+"store",dataType:"json",data:$("#formSubUnit").serialize(),success:function(a){a.status?($("#noDataSubUnit").hide(),$("#tableSubUnit").show(),t="",t+='<tr id="rowSubUnit'+a.data.id+'">',t+="<td>"+urusan.kode+"</td>",t+="<td>"+bidang.kode+"</td>",t+="<td>"+unit.kode+"</td>",t+='<td id="rowKodeSubUnit'+a.data.id+'">'+a.data.kode+"</td>",t+='<td id="rowNamaSubUnit'+a.data.id+'">'+a.data.nama_sub_unit+"</td>","superadmin"===user.role&&(t+="<td>",t+='<button class="btn btn-xs btn-outline-warning" onclick="editSubUnit(\''+a.data.id+'\')" id="btnEditSubUnit'+a.data.id+'" data-update-url="" data-unit-id="'+a.data.id+'"><i class="fa fa-edit"></i></button> ',t+='<button class="btn btn-xs btn-outline-danger" id="btnDeleteSubUnit'+a.data.id+'" data-delete-url="'+subUnitUrl+"delete/"+a.data.id+'" data-unit-id="'+a.data.id+'" onclick="deleteSubUnit('+a.data.id+')"> <i class="fa fa-trash"></i></button>',t+="</td>"),t+="</tr>",$("#tableSubUnitBody").prepend(t),successSwal("Berhasil menambah data unit."),$("#modalSubUnit").modal("hide")):showError(a.error,"formSubUnit")}})})});
