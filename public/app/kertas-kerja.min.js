const sbTgl=window.location.origin+"/sb-tgl/",sbUrl=window.location.origin+"/kertas-kerja/",pendapatanUrl=window.location.origin+"/sb-tgl/pendapatan/",belanjaUrl=window.location.origin+"/sb-tgl/belanja/",confirmDelete={title:"Apakah Anda yakin?",text:"Data yang telah dihapus tidak dapat dikembalikan dan Anda akan kehilangan HISTORY dari kertas kerja Anda!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, hapus sekarang!",cancelButtonText:"Tidak, batal hapus!",reverseButtons:!0};let oldNominal=0,tanggalKertasKerja=0,tanggalIDKertasKerja=0,jenisPembahasan=$("#jenisPembahasan").val();const lockWarningMessage="STRUKTUR TERKUNCI, Anda tidak dapat menambah ataupun mengubah struktur.";function successSwal(a){return Swal.fire("Berhasil!",a,"success")}function errorSwal(a){return Swal.fire("Gagal!",a,"error")}function warningSwal(a){return Swal.fire("Peringatan!",a,"warning")}function showError(a,t){$.each(a,function(a,e){$("#"+t).find($("input[name="+a+"]")).addClass("is-invalid"),$("#"+t).find($("#"+a+"_feedback")).text(e)})}function myDateFormat(a){var t=new Date(a.toString().split("/").reverse().join("-"));return("0"+t.getDate()).slice(-2)+"/"+("0"+(t.getMonth()+1)).slice(-2)+"/"+t.getFullYear()}function formatRupiah(a){return AutoNumeric.format(a,{digitGroupSeparator:".",decimalCharacter:",",decimalCharacterAlternative:"."})}function deleteTanggalKertasKerja(a){if(1==$("#statusMurni").val())return warningSwal(lockWarningMessage),!1;Swal.fire(confirmDelete).then(t=>{t.value&&$.ajax({type:"GET",url:sbTgl+"delete/"+a,dataType:"json",success:function(t){t.status?(successSwal(t.message),$(".btn-kertas-kerja-g:nth-last-of-type(2)").append('<button type="button" class="btn btn-xs btn-outline-danger" id="btnDeleteTanggal" onclick="deleteTanggalKertasKerja('+$(".btn-kertas-kerja-g:nth-last-of-type(2)").data("tanggal-id")+')"><i class="fa fa-times"></i></button>'),$("#tglKertasKerja"+a).remove()):errorSwal(t.message)}})})}$(function(){$("#tanggal").daterangepicker({singleDatePicker:!0,showDropdowns:!0,locale:{format:"DD/MM/YYYY",separator:" - ",applyLabel:"Apply",cancelLabel:"Cancel",fromLabel:"From",toLabel:"To",customRangeLabel:"Custom",weekLabel:"W",daysOfWeek:["Ming","Sen","Sel","Rab","Kam","Jum","Sab"],monthNames:["Januari","Februari","Maret","April","Mei","Juni","Juli","Augustus","September","Oktober","November","Desember"],firstDay:1}}),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$("#btnTambahSbTanggal").on("click",function(a){if(a.preventDefault(),1==$("#statusMurni").val())return warningSwal(lockWarningMessage),!1;$("#modalFormTanggal").text("Form Tambah Kertas Kerja"),$("#btnSimpanTanggal").show(),$("#btnSimpanUbahTanggal").hide(),$("#tahunId").val($(this).data("tahun-id")),$("#modalTanggal").modal("show")}),$("#btnSimpanTanggal").on("click",function(a){a.preventDefault();var t="";$.ajax({type:"POST",url:sbTgl+"store",dataType:"json",data:$("#formTanggal").serialize(),success:function(a){console.log(a),a.status?($("#btnDeleteTanggal").remove(),t="",t+=' <div class="btn-group btn-group-xs" role="group" id="tglKertasKerja'+a.data.id+'">',t+='<a href="'+window.location.origin+"/sb/t/"+a.data.sd_tahun_id+"/kertas-kerja/"+jenisPembahasan+"/d/"+a.data.id+'/list" class="btn btn-xs btn-outline-dark btn-kertas-kerja" id="btnFetchKertasKerja'+a.data.id+'">'+myDateFormat(a.data.tanggal)+"</a>",t+='<button type="button" class="btn btn-xs btn-outline-danger" id="btnDeleteTanggal" data-tanggal-id="'+a.data.id+'" onclick="deleteTanggalKertasKerja('+a.data.id+')"><i class="fa fa-times"></i></button>',t+="</div>",$("#buttonBar").append(t),successSwal("Berhasil menambah tanggal kertas kerja."),$("#modalTanggal").modal("hide")):showError(a.error,"formTanggal")},error:function(a){errorSwal(a.responseJSON.message)}},"json")})}),$("#btnKunciKertasKerja").on("click",function(a){$.ajax({type:"GET",url:window.location.origin+"/sb/t/kertas-kerja/kunci-struktur-murni/"+$(this).data("id"),dataType:"json",success:function(a){a.status&&($("#btnKunciKertasKerja").hide(),$("#btnBukaKertasKerja").show(),$("#statusMurni").val(1),$("#lockStatus").text("Terkunci"),successSwal(a.message))}})}),$("#btnBukaKertasKerja").on("click",function(a){$.ajax({type:"GET",url:window.location.origin+"/sb/t/kertas-kerja/buka-struktur-murni/"+$(this).data("id"),dataType:"json",success:function(a){a.status&&($("#btnBukaKertasKerja").hide(),$("#btnKunciKertasKerja").show(),$("#statusMurni").val(0),$("#lockStatus").text("Terbuka"),successSwal(a.message))}})});
