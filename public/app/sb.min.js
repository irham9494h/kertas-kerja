const sbTgl=window.location.origin+"/sb-tgl/",sbUrl=window.location.origin+"/sb/t/kertas-kerja/d/",pendapatanUrl=window.location.origin+"/sb/t/kertas-kerja/d/",belanjaUrl=window.location.origin+"/sb/t/kertas-kerja/d/",confirmDelete={title:"Apakah Anda yakin?",text:"Data yang telah dihapus tidak dapat dikembalikan dan Anda akan kehilangan HISTORY dari kertas kerja Anda!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, hapus sekarang!",cancelButtonText:"Tidak, batal hapus!",reverseButtons:!0};let oldNominal=0,tanggalKertasKerja=0,tanggalIDKertasKerja=0,activeTab="pendapatan",totalPendapatan=0,totalBelanja=0,totalPembiayaan=0;function successSwal(a){return Swal.fire("Berhasil!",a,"success")}function errorSwal(a){return Swal.fire("Gagal!",a,"error")}function showError(a,t){$.each(a,function(a,e){$("#"+t).find($("input[name="+a+"]")).addClass("is-invalid"),$("#"+t).find($("#"+a+"_feedback")).text(e).addClass("d-block")})}function myDateFormat(a){var t=new Date(a.toString().split("/").reverse().join("-"));return("0"+t.getDate()).slice(-2)+"/"+("0"+(t.getMonth()+1)).slice(-2)+"/"+t.getFullYear()}function formatRupiah(a){return AutoNumeric.format(parseFloat(a),{digitGroupSeparator:".",decimalCharacter:",",decimalCharacterAlternative:"."})}function deleteTanggalKertasKerja(a){Swal.fire(confirmDelete).then(t=>{t.value&&$.ajax({type:"GET",url:sbTgl+"delete/"+a,dataType:"json",success:function(t){t.status?(successSwal(t.message),$(".btn-kertas-kerja-g:nth-last-of-type(2)").append('<button type="button" class="btn btn-xs btn-outline-danger" id="btnDeleteTanggal" onclick="deleteTanggalKertasKerja('+$(".btn-kertas-kerja-g:nth-last-of-type(2)").data("tanggal-id")+')"><i class="fa fa-times"></i></button>'),$("#tglKertasKerja"+a).remove()):errorSwal(t.message)}})})}function fetchKertasKerja(a){$("#btnTambahBelanja").hide().data("belanja-tanggal-id",a),$("#btnTambahPembiayaan").hide(),$("#btnTambahPendapatan").show().data("pendapatan-tanggal-id",a),tanggalIDKertasKerja=a,$(".btn-kertas-kerja").removeClass("btn-dark").addClass("btn-outline-dark"),$("#btnFetchKertasKerja"+a).removeClass("btn-outline-dark").addClass("btn-dark"),$.ajax({type:"GET",url:pendapatanUrl+a+"/list/json",dataType:"json",success:function(a){$("#itemKertasKerjaLoader").html("");var t="",e="",n=0;if(a.data.length>0){for($("#totalSumberDana").text(formatRupiah(a.totalSumberDana)).show(),totalPendapatan=a.totalSumberDana,e="",i=0;i<a.opd.length;i++)e+='<div class="d-flex p-2 opd">',e+='<p class="mb-0">'+a.opd[i].bidang.urusan.kode+"."+a.opd[i].bidang.kode+"."+a.opd[i].kode+" "+a.opd[i].nama_unit+"</p>",e+='<p class="mb-0 ml-auto" id="total'+a.opd[i].id+'">Rp. <span id="totalNilai'+a.opd[i].id+'">0</span></p>',e+="</div>",e+='<div class="mb-2 pb-0" id="opd'+a.opd[i].id+'">',e+="</div>";for($("#pendapatanContentTable").append(e),i=0;i<a.data.length;i++){for(n=0,t="",t+='<table class="w-100 table table-sm mb-0">',t+="<thead>",t+="<tr>",t+="<th>Uraian</th>",t+="<th>Nilai</th>",t+="</tr>",t+="</thead>",t+='<tbody id="tblOpd'+a.data[i].unit_id+'">',j=0;j<a.data[i].list_uraian.length;j++)t+="<tr>",t+='<td style="width: 80%">'+a.data[i].list_uraian[j].uraian+"</td>",t+='<td style="text-align: end; width: 20%; padding-right: 0.5rem !important;"><a href="#" class="text-dark nominal" id="item'+a.data[i].list_uraian[j].id+'" onclick="editItem('+a.data[i].list_uraian[j].id+","+a.data[i].list_uraian[j].nilai+', event)">'+formatRupiah(a.data[i].list_uraian[j].nilai)+"</a></td>",t+="</tr>",n+=a.data[i].list_uraian[j].nilai;t+="</tbody>",t+="</table>",$("#opd"+a.data[i].unit_id).html(t),$("#totalNilai"+a.data[i].unit_id).html(formatRupiah(n)).attr("data-total"+a.data[i].unit_id,n)}$("#noDataPendapatan").hide(),$("#tblPendapatan").show()}else $("#tblPendapatan").hide(),$("#bodyTblPendapatan").html(""),$("#noDataPendapatan").show()}})}function editItem(a,t,e){e.preventDefault(),activeTab="pendapatan",$("#kertasKerjaId").val(a),$("#updateNominalTanggalId").val(tanggalIDKertasKerja),$("#updateNominalTotalPendapatan").val("").hide(),$("#updateNominalTotalPembiayaan").val("").hide(),$("#updateModalGunakanPembiayaan").hide(),$("#updateModalBelanjaPembiayaan").hide(),$("#updateNominalNilaiPembiayaan").val("").hide(),$("#updateNominalIdPembiayaan").val("").hide(),$("#btnSimpanUbahNominal").show(),newNominal.set(t),oldNominal=t,$("#modalNominal").modal("show")}function editItemBelanja(a,t,e,n,i){i.preventDefault(),activeTab="belanja",$("#kertasKerjaId").val(a),$("#updateNominalTanggalId").val(tanggalIDKertasKerja),$("#updateNominalTotalPendapatan").show().val(totalPendapatan),$("#updateNominalTotalPembiayaan").show().val(totalPembiayaan),$("#updateModalGunakanPembiayaan").show(),$("#updateModalBelanjaPembiayaan").show(),$("#updateNominalNilaiPembiayaan").show().val(n),$("#updateNominalIdPembiayaan").show().val(e),$("#btnSimpanUbahNominal").show(),$("#updateModalNilaiWarning").hide(),$("#updateModalPembiayaanWarning").hide(),$.ajax({type:"GET",url:window.location.origin+"/sb/t/kertas-kerja/rekening-pembiayaan/"+e,dataType:"json",success:function(a){var t;t='<option value="'+a.id+'">'+a.obyek.jenis.kelompok.akun.kode+"."+a.obyek.jenis.kelompok.kode+"."+a.obyek.jenis.kode+"."+a.obyek.kode+"."+a.kode+". "+a.nama_rincian_obyek+"</option>",$("#updateModalRekeningBelanjaPembiayaan").html(t)}}),$("#updateModalRekeningBelanjaPembiayaan").val(e).trigger("change"),null!==e?($("#UpdateModalpembiayaanCheckbox").removeAttr("disabled").attr("checked",!0),$("#updateModalRekeningBelanjaPembiayaan").removeAttr("disabled")):($("#UpdateModalpembiayaanCheckbox").removeAttr("checked").attr("disabled",!0),$("#updateModalRekeningBelanjaPembiayaan").prop("disabled",!0)),newNominal.set(t),oldNominal=t,$("#modalNominal").modal("show")}function editItemPembiayaan(a,t,e){e.preventDefault(),activeTab="pembiayaan",$("#kertasKerjaId").val(a),$("#updateNominalTanggalId").val(tanggalIDKertasKerja),$("#updateNominalTotalPendapatan").val("").hide(),$("#updateNominalTotalPembiayaan").val("").hide(),$("#updateModalGunakanPembiayaan").hide(),$("#updateModalBelanjaPembiayaan").hide(),$("#updateNominalNilaiPembiayaan").val("").hide(),$("#updateNominalIdPembiayaan").val("").hide(),$("#btnSimpanUbahNominal").show(),newNominal.set(t),oldNominal=t,$("#modalNominal").modal("show")}function fetchKertasKerjaBelanja(a){$("#btnTambahBelanja").show().data("belanja-tanggal-id",a),$.ajax({type:"GET",url:sbUrl+a+"/list/pend/json",dataType:"json",success:function(a){$("#totalSumberDana").text(formatRupiah(a.totalSumberDana)).show(),totalPendapatan=a.totalSumberDana,$("#totalBelanja").text(formatRupiah(a.totalBelanja)).show(),totalBelanja=a.totalBelanja,$("#totalPembiayaan").text(formatRupiah(a.totalPembiayaan)).show(),totalPembiayaan=a.totalPembiayaan,$("#itemKertasKerjaBelanjaLoader").html("");var t="",e="",n=0;if(a.data.length>0){for(e="",i=0;i<a.opd.length;i++)e+='<div class="d-flex p-2 opd">',e+='<p class="mb-0">'+a.opd[i].bidang.urusan.kode+"."+a.opd[i].bidang.kode+"."+a.opd[i].kode+" "+a.opd[i].nama_unit+"</p>",e+='<p class="mb-0 ml-auto" id="total'+a.opd[i].id+'">Rp. <span id="totalNilaiBelanja'+a.opd[i].id+'">0</span></p>',e+="</div>",e+='<div class="mb-2 pb-0" id="opdBelanja'+a.opd[i].id+'">',e+="</div>";for($("#belanjaContentTable").append(e),i=0;i<a.data.length;i++){for(n=0,t="",t+='<table class="w-100 table table-sm mb-0">',t+="<thead>",t+="<tr>",t+="<th>Uraian</th>",t+="<th>Nilai</th>",t+="</tr>",t+="</thead>",t+='<tbody id="tblOpdBelanja'+a.data[i].unit_id+'">',j=0;j<a.data[i].list_uraian.length;j++)t+="<tr>",t+='<td style="width: 80%">'+a.data[i].list_uraian[j].uraian+"</td>",null==a.data[i].list_uraian[j].pembiayaan_id?t+='<td style="text-align: end; width: 20%; padding-right: 0.5rem !important;"><a href="#" class="text-dark nominal" id="itemBelanja'+a.data[i].list_uraian[j].id+'" onclick="editItemBelanja('+a.data[i].list_uraian[j].id+","+a.data[i].list_uraian[j].nilai+","+a.data[i].list_uraian[j].pembiayaan_id+","+a.data[i].list_uraian[j].nilai_pembiayaan+', event)">'+formatRupiah(a.data[i].list_uraian[j].nilai)+"</a></td>":t+='<td style="text-align: end; width: 20%; padding-right: 0.5rem !important;"><a href="#" class="text-dark nominal" id="itemBelanja'+a.data[i].list_uraian[j].id+'" onclick="editItemBelanja('+a.data[i].list_uraian[j].id+","+a.data[i].list_uraian[j].nilai+","+a.data[i].list_uraian[j].pembiayaan_id+","+a.data[i].list_uraian[j].nilai_pembiayaan+', event)"><span class="text-warning">'+formatRupiah(a.data[i].list_uraian[j].nilai)+"</span></a></td>",t+="</tr>",n+=a.data[i].list_uraian[j].nilai;t+="</tbody>",t+="</table>",$("#opdBelanja"+a.data[i].unit_id).html(t),$("#totalNilaiBelanja"+a.data[i].unit_id).html(formatRupiah(n)).attr("data-total"+a.data[i].unit_id,n)}$("#noDataBelanja").hide(),$("#tblBelanja").show()}else $("#tblBelanja").hide(),$("#bodyTblBelanja").html(""),$("#noDataBelanja").show()}})}function fetchKertasKerjaPembiayaan(a){$("#btnTambahPendapatan").hide(),$("#btnTambahPembiayaan").show().data("pembiayaan-tanggal-id",a),$("#btnTambahBelanja").hide(),$.ajax({type:"GET",url:sbUrl+a+"/list/pembiayaan/json",dataType:"json",success:function(a){$("#totalSumberDana").hide(),$("#statusSumberDana").hide(),$("#totalPembiayaan").text(formatRupiah(a.totalPembiayaan)),totalPembiayaan=a.totalPembiayaan,$("#itemKertasKerjaPembiayaanLoader").html("");var t="",e="",n=0;if(a.data.length>0){for(e="",i=0;i<a.opd.length;i++)e+='<div class="d-flex p-2 opd">',e+='<p class="mb-0">'+a.opd[i].bidang.urusan.kode+"."+a.opd[i].bidang.kode+"."+a.opd[i].kode+" "+a.opd[i].nama_unit+"</p>",e+='<p class="mb-0 ml-auto" id="total'+a.opd[i].id+'">Rp. <span id="totalNilaiPembiayaan'+a.opd[i].id+'">0</span></p>',e+="</div>",e+='<div class="mb-2 pb-0" id="opdPembiayaan'+a.opd[i].id+'">',e+="</div>";for($("#pembiayaanContentTable").append(e),i=0;i<a.data.length;i++){for(n=0,t="",t+='<table class="w-100 table table-sm mb-0">',t+="<thead>",t+="<tr>",t+="<th>Uraian</th>",t+="<th>Nilai</th>",t+="</tr>",t+="</thead>",t+='<tbody id="tblOpdPembiayaan'+a.data[i].unit_id+'">',j=0;j<a.data[i].list_uraian.length;j++)t+="<tr>",t+='<td style="width: 80%">'+a.data[i].list_uraian[j].uraian+"</td>",t+='<td style="text-align: end; width: 20%; padding-right: 0.5rem !important;"><a href="#" class="text-dark nominal" id="itemPembiayaan'+a.data[i].list_uraian[j].id+'" onclick="editItemPembiayaan('+a.data[i].list_uraian[j].id+","+a.data[i].list_uraian[j].nilai+', event)">'+formatRupiah(a.data[i].list_uraian[j].nilai)+"</a></td>",t+="</tr>",n+=a.data[i].list_uraian[j].nilai;t+="</tbody>",t+="</table>",$("#opdPembiayaan"+a.data[i].unit_id).html(t),$("#totalNilaiPembiayaan"+a.data[i].unit_id).html(formatRupiah(n)).attr("data-total"+a.data[i].unit_id,n)}$("#noDataPembiayaan").hide(),$("#tblpembiayaan").show()}else $("#tblPembiayaan").hide(),$("#bodyTblPembiayaan").html(""),$("#noDataPembiayaan").show(),$("#itemKertasKerjaPembiayaanLoader").html("")}})}$(function(){$("#tanggal").daterangepicker({singleDatePicker:!0,showDropdowns:!0,locale:{format:"DD/MM/YYYY",separator:" - ",applyLabel:"Apply",cancelLabel:"Cancel",fromLabel:"From",toLabel:"To",customRangeLabel:"Custom",weekLabel:"W",daysOfWeek:["Ming","Sen","Sel","Rab","Kam","Jum","Sab"],monthNames:["Januari","Februari","Maret","April","Mei","Juni","Juli","Augustus","September","Oktober","November","Desember"],firstDay:1}}),$("#opdPendapatan").select2(),$("#rekeningPendapatan").select2({minimumInputLength:1,allowClear:!1,placeholder:"Nama rekening",ajax:{dataType:"json",url:window.location.origin+"/sb/t/kertas-kerja/rekening-pendapatan",delay:1e3,data:function(a){return{nama_rekening:a.term}},processResults:function(a,t){var e=[];return $.each(a,function(a,t){e.push({id:t.id,text:t.obyek.jenis.kelompok.akun.kode+"."+t.obyek.jenis.kelompok.kode+"."+t.obyek.jenis.kode+"."+t.obyek.kode+"."+t.kode+". "+t.nama_rincian_obyek})}),{results:e}}},language:{noResults:function(a){return"Rekening tidak ditemukan."},searching:function(){return"Mencari..."}}}).on("select2:select",function(a){$("#rekeningPendapatan option:selected").val()}),$("#opdBelanja").select2(),$("#rekeningBelanja").select2({minimumInputLength:1,allowClear:!1,placeholder:"Nama rekening",ajax:{dataType:"json",url:window.location.origin+"/sb/t/kertas-kerja/rekening-belanja",delay:1e3,data:function(a){return{nama_rekening:a.term}},processResults:function(a,t){var e=[];return $.each(a,function(a,t){e.push({id:t.id,text:t.obyek.jenis.kelompok.akun.kode+"."+t.obyek.jenis.kelompok.kode+"."+t.obyek.jenis.kode+"."+t.obyek.kode+"."+t.kode+". "+t.nama_rincian_obyek})}),{results:e}}},language:{noResults:function(a){return"Rekening tidak ditemukan."},searching:function(){return"Mencari..."}}}).on("select2:select",function(a){$("#rekeningPendapatan option:selected").val()}),$("#rekeningSumberDana").select2({minimumInputLength:1,allowClear:!1,placeholder:"Nama rekening",ajax:{dataType:"json",url:window.location.origin+"/sb/t/kertas-kerja/rekening-pendapatan",delay:1e3,data:function(a){return{nama_rekening:a.term}},processResults:function(a,t){var e=[];return $.each(a,function(a,t){e.push({id:t.id,text:t.obyek.jenis.kelompok.akun.kode+"."+t.obyek.jenis.kelompok.kode+"."+t.obyek.jenis.kode+"."+t.obyek.kode+"."+t.kode+". "+t.nama_rincian_obyek})}),{results:e}}},language:{noResults:function(a){return"Rekening tidak ditemukan."},searching:function(){return"Mencari..."}}}).on("select2:select",function(a){$("#rekeningPendapatan option:selected").val()}),$("#opdPembiayaan").select2(),$("#rekeningPembiayaan").select2({minimumInputLength:1,allowClear:!1,placeholder:"Nama rekening",ajax:{dataType:"json",url:window.location.origin+"/sb/t/kertas-kerja/rekening-pembiayaan",delay:1e3,data:function(a){return{nama_rekening:a.term}},processResults:function(a,t){var e=[];return $.each(a,function(a,t){e.push({id:t.id,text:t.obyek.jenis.kelompok.akun.kode+"."+t.obyek.jenis.kelompok.kode+"."+t.obyek.jenis.kode+"."+t.obyek.kode+"."+t.kode+". "+t.nama_rincian_obyek})}),{results:e}}},language:{noResults:function(a){return"Rekening tidak ditemukan."},searching:function(){return"Mencari..."}}}).on("select2:select",function(a){$("#rekeningPendapatan option:selected").val()}),$("#rekeningBelanjaPembiayaan").select2({minimumInputLength:1,allowClear:!1,placeholder:"Nama rekening",ajax:{dataType:"json",url:window.location.origin+"/sb/t/kertas-kerja/rekening-pembiayaan",delay:1e3,data:function(a){return{nama_rekening:a.term}},processResults:function(a,t){var e=[];return $.each(a,function(a,t){e.push({id:t.id,text:t.obyek.jenis.kelompok.akun.kode+"."+t.obyek.jenis.kelompok.kode+"."+t.obyek.jenis.kode+"."+t.obyek.kode+"."+t.kode+". "+t.nama_rincian_obyek})}),{results:e}}},language:{noResults:function(a){return"Rekening tidak ditemukan."},searching:function(){return"Mencari..."}}}).on("select2:select",function(a){$("#rekeningPendapatan option:selected").val()}),$("#updateModalRekeningBelanjaPembiayaan").select2({minimumInputLength:1,allowClear:!1,placeholder:"Nama rekening",ajax:{dataType:"json",url:window.location.origin+"/sb/t/kertas-kerja/rekening-pembiayaan",delay:1e3,data:function(a){return{nama_rekening:a.term}},processResults:function(a,t){var e=[];return $.each(a,function(a,t){e.push({id:t.id,text:t.obyek.jenis.kelompok.akun.kode+"."+t.obyek.jenis.kelompok.kode+"."+t.obyek.jenis.kode+"."+t.obyek.kode+"."+t.kode+". "+t.nama_rincian_obyek})}),{results:e}}},language:{noResults:function(a){return"Rekening tidak ditemukan."},searching:function(){return"Mencari..."}}}).on("select2:select",function(a){$("#rekeningPendapatan option:selected").val()}),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$("form").on("focus","input[type=number]",function(a){$(this).on("wheel.disableScroll",function(a){a.preventDefault()})}),$("form").on("blur","input[type=number]",function(a){$(this).off("wheel.disableScroll")}),newNominal=new AutoNumeric("#newNominal",{digitGroupSeparator:".",decimalCharacter:",",decimalCharacterAlternative:"."}),formatPendapatan=new AutoNumeric("#nilaiPendapatan",{digitGroupSeparator:".",decimalCharacter:",",decimalCharacterAlternative:"."}),formatBelanja=new AutoNumeric("#nilaiBelanja",{digitGroupSeparator:".",decimalCharacter:",",decimalCharacterAlternative:"."}),formatPembiayaan=new AutoNumeric("#nilaiPembiayaan",{digitGroupSeparator:".",decimalCharacter:",",decimalCharacterAlternative:"."}),$("#btnTambahSbTanggal").on("click",function(a){a.preventDefault(),$("#modalFormTanggal").text("Form Tambah Kertas Kerja"),$("#btnSimpanTanggal").show(),$("#btnSimpanUbahTanggal").hide(),$("#tahunId").val($(this).data("tahun-id")),$("#modalTanggal").modal("show")}),$("#btnSimpanTanggal").on("click",function(a){a.preventDefault();var t="";$.ajax({type:"POST",url:sbTgl+"store",dataType:"json",data:$("#formTanggal").serialize(),success:function(a){a.status?($("#btnDeleteTanggal").remove(),t="",t+=' <div class="btn-group btn-group-xs" role="group" id="tglKertasKerja'+a.data.id+'">',t+='<a href="'+window.location.origin+"/sb/t/"+a.data.sd_tahun_id+"/kertas-kerja/d/"+a.data.id+'/list" class="btn btn-xs btn-outline-dark btn-kertas-kerja" id="btnFetchKertasKerja'+a.data.id+'">'+myDateFormat(a.data.tanggal)+"</a>",t+='<button type="button" class="btn btn-xs btn-outline-danger" id="btnDeleteTanggal" data-tanggal-id="'+a.data.id+'" onclick="deleteTanggalKertasKerja('+a.data.id+')"><i class="fa fa-times"></i></button>',t+="</div>",$("#buttonBar").append(t),successSwal("Berhasil menambah tanggal kertas kerja."),$("#modalTanggal").modal("hide")):showError(a.error,"formTanggal")},error:function(a){errorSwal(a.responseJSON.message)}},"json")})}),$("#btnTambahPendapatan").on("click",function(){$("#formItemPendapatan").trigger("reset"),$("#modalFormItemKertasKerja").text("Form Tambah Kertas Kerja Pendapatan"),$("#pendapatanTanggalId").val($(this).data("pendapatan-tanggal-id")),$("#formItemPendapatan").trigger("reset"),$("#modalItemPendapatan").modal("show")}),$("#pendapatan-tab").on("click",function(a){a.preventDefault(),$("#pendapatanSatatusText").show(),$("#statusSumberDana").text("Total").show(),$("#belanjaStatusText").hide(),$("#pembiayaanStatusText").hide(),$("#cardKertasKerja").hide().show(),$("#pendapatanContentTable").html(""),$("#noDataPendapatan").hide(),$("#itemKertasKerjaLoader").html("").append('<div class="d-flex justify-content-center"><div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div></div>'),fetchKertasKerja(tanggalIDKertasKerja)}),$("#btnSimpanItemPendapatan").on("click",function(a){a.preventDefault();formatPendapatan.unformat(),$.ajax({type:"POST",url:pendapatanUrl+"store-pendapatan",dataType:"json",data:$("#formItemPendapatan").serialize(),success:function(a){var t="";a.status?($("#pendapatanContentTable").children().length>0?$("#opd"+a.data.unit_id).children().length>0?(t="",t+="<tr>",t+='<td style="width: 80%">'+a.data.uraian+"</td>",t+='<td style="text-align: end; width: 20%; padding-right: 0.5rem !important;"><a href="#" class="text-dark nominal" onclick="editItem('+a.data.id+", "+a.data.nilai+', event)">'+formatRupiah(parseFloat(a.data.nilai))+"</a></td>",t+="</tr>",$("#tblOpd"+a.data.unit_id).append(t),newTotal=parseFloat($("#totalNilai"+a.data.unit_id).data("total"+a.data.unit_id))+parseFloat(a.data.nilai),$("#totalNilai"+a.data.unit_id).html(formatRupiah(newTotal)).attr("data-total"+a.data.unit_id,newTotal),$("#totalSumberDana").text(formatRupiah(a.totalSumberDana)),totalPendapatan=a.totalSumberDana):(t="",t+='<table class="w-100 table table-sm mb-0">',t+="<thead>",t+="<tr>",t+="<th>Uraian</th>",t+="<th>Nilai</th>",t+="</tr>",t+="</thead>",t+='<tbody id="tblOpd'+a.data.unit_id+'">',t+="<tr>",t+='<td style="width: 80%">'+a.data.uraian+"</td>",t+='<td style="text-align: end; width: 20%; padding-right: 0.5rem !important;"><a href="#" class="text-dark nominal" id="item'+a.data.id+'" onclick="editItem('+a.data.id+", "+a.data.nilai+', event)">'+formatRupiah(parseFloat(a.data.nilai))+"</a></td>",t+="</tr>",t+="</tbody>",t+="</table>",$("#opd"+a.data.unit_id).html(t),$("#totalNilai"+a.data.unit_id).html("Rp. "+formatRupiah(a.data.nilai)).attr("data-total"+a.data.unit_id,a.data.nilai),$("#totalSumberDana").text(formatRupiah(a.totalSumberDana)),totalPendapatan=a.totalSumberDana):fetchKertasKerja(tanggalIDKertasKerja),$("#modalItemPendapatan").modal("hide"),successSwal("Berhsail")):showError(a.error,"formItemPendapatan")}})}),$("#newNominal").keyup(function(){var a=$("#newNominal").val(),t=oldNominal;if(a=(a=a.replace(/\./g,"")).replace(/\,/g,"."),"belanja"===activeTab){var e=$("#updateNominalIdPembiayaan").val(),n=$("#updateNominalNilaiPembiayaan").val(),i=0;n>t?n-t:t-n,a>t?(i=a-t,$("#UpdateModalpembiayaanCheckbox").is(":checked")?i>totalPendapatan?i>totalPembiayaan?($("#updateModalPembiayaanWarning").show(),$("#btnSimpanUbahNominal").hide()):($("#updateModalPembiayaanWarning").hide(),$("#btnSimpanUbahNominal").show()):($("#UpdateModalpembiayaanCheckbox").removeAttr("checked").attr("disabled",!0),$("#updateModalRekeningBelanjaPembiayaan").attr("disabled",!0),$("#updateModalRekeningBelanjaPembiayaan").val($("#updateModalRekeningBelanjaPembiayaan option:first-child").val()).trigger("change"),$("#updateModalPembiayaanWarning").hide(),$("#updateModalNilaiWarning").hide(),$("#btnSimpanUbahNominal").show()):($("#updateModalRekeningBelanjaPembiayaan").attr("disabled",!0),i>totalPendapatan?($("#updateModalNilaiWarning").show(),i>totalPembiayaan?($("#updateModalPembiayaanWarning").show(),$("#btnSimpanUbahNominal").hide()):($("#updateModalPembiayaanWarning").hide(),$("#btnSimpanUbahNominal").show(),$("#UpdateModalpembiayaanCheckbox").removeAttr("disabled").attr("checked",!0),$("#updateModalRekeningBelanjaPembiayaan").removeAttr("disabled"),$("#updateModalRekeningBelanjaPembiayaan").val($("#updateModalRekeningBelanjaPembiayaan option:first-child").val()).trigger("change"))):($("#updateModalNilaiWarning").hide(),$("#btnSimpanUbahNominal").show()))):(i=t-a,$("#updateModalNilaiWarning").hide(),$("#updateModalPembiayaanWarning").hide(),$("#btnSimpanUbahNominal").show(),""==e&&($("#UpdateModalpembiayaanCheckbox").removeAttr("checked").attr("disabled",!0),$("#updateModalRekeningBelanjaPembiayaan").attr("disabled",!0)))}}),$("#UpdateModalpembiayaanCheckbox").on("click",function(){var a=$("#newNominal").val(),t=($("#updateNominalNilaiPembiayaan").val(),oldNominal),e=(a=(a=a.replace(/\./g,"")).replace(/\,/g,"."))-t;$(this).is(":checked")?($("#updateModalNilaiWarning").hide(),e>totalPembiayaan?($("#btnSimpanUbahNominal").hide(),$("#updateModalPembiayaanWarning").show()):($("#btnSimpanUbahNominal").show(),$("#updateModalPembiayaanWarning").hide()),$("#updateModalRekeningBelanjaPembiayaan").removeAttr("disabled")):a>totalPendapatan?($("#btnSimpanUbahNominal").hide(),$("#updateModalRekeningBelanjaPembiayaan").attr("disabled",!0),$("#updateModalNilaiWarning").show()):($("#updateModalNilaiWarning").hide(),$("#btnSimpanUbahNominal").show())}),$("#btnSimpanUbahNominal").on("click",function(a){a.preventDefault(),newNominal.unformat();var t=$("#newNominal").val(),e="",n="";if("pendapatan"===activeTab)e="update-nominal",n={new_nominal:t,uraian_id:$("#kertasKerjaId").val(),sd_tanggal_id:$("#updateNominalTanggalId").val()};else if("belanja"===activeTab){e="update-nominal-belanja";var i=null,l=null;$("#UpdateModalpembiayaanCheckbox").is(":disabled")||(i=$("#UpdateModalpembiayaanCheckbox").val(),l=$("#updateModalRekeningBelanjaPembiayaan").val()),n={new_nominal:t,uraian_id:$("#kertasKerjaId").val(),sd_tanggal_id:$("#updateNominalTanggalId").val(),total_pendapatan:$("#updateNominalTotalPendapatan").val(),total_pembiayaan:$("#updateNominalTotalPembiayaan").val(),pembiayaan_checkbox:i,pembiayaan_id:l}}else"pembiayaan"===activeTab&&(e="update-nominal-pembiayaan",n={new_nominal:t,uraian_id:$("#kertasKerjaId").val(),sd_tanggal_id:$("#updateNominalTanggalId").val()});$.ajax({type:"POST",url:sbUrl+e,dataType:"json",data:n,success:function(a){var e=0,n=0;a.status?(successSwal(a.message),$("#modalNominal").modal("hide"),"pendapatan"===activeTab?(tot=new AutoNumeric("#totalNilai"+a.data.unit_id,{digitGroupSeparator:".",decimalCharacter:",",decimalCharacterAlternative:"."}),e=tot.getNumber(),oldNominal>a.data.nilai?(n=oldNominal-t,$("#totalNilai"+a.data.unit_id).html(formatRupiah(e-n)).attr("data-total",e-n)):oldNominal<t&&(n=a.data.nilai-oldNominal,$("#totalNilai"+a.data.unit_id).html(formatRupiah(e+n)).attr("data-total",e+n)),$("#item"+a.data.id).attr("onclick","editItem("+a.data.id+", "+t+", event)").text(formatRupiah(t)),$("#totalSumberDana").text(formatRupiah(a.totalSumberDana)),totalPendapatan=a.totalSumberDana):"belanja"===activeTab?(tBelanja=new AutoNumeric("#totalNilaiBelanja"+a.data.unit_id,{digitGroupSeparator:".",decimalCharacter:",",decimalCharacterAlternative:"."}),e=tBelanja.getNumber(),oldNominal>a.data.nilai?(n=oldNominal-t,$("#totalNilaiBelanja"+a.data.unit_id).html(formatRupiah(e-n)).attr("data-total",e-n)):oldNominal<t&&(n=a.data.nilai-oldNominal,$("#totalNilaiBelanja"+a.data.unit_id).html(formatRupiah(e+n)).attr("data-total",e+n)),$("#itemBelanja"+a.data.id).attr("onclick","editItemBelanja("+a.data.id+", "+t+", "+a.data.pembiayaan_id+", "+a.data.nilai_pembiayaan+", event)").text(formatRupiah(t)),$("#totalSumberDana").text(formatRupiah(a.totalSumberDana)).show(),totalPendapatan=a.totalSumberDana,$("#totalPembiayaan").text(formatRupiah(a.totalPembiayaan)).show(),totalPembiayaan=a.totalPembiayaan,$("#totalBelanja").text(formatRupiah(a.totalBelanja)),totalBelanja=a.totalBelanja):"pembiayaan"===activeTab&&(tPembiayaan=new AutoNumeric("#totalNilaiPembiayaan"+a.data.unit_id,{digitGroupSeparator:".",decimalCharacter:",",decimalCharacterAlternative:"."}),e=tPembiayaan.getNumber(),oldNominal>a.data.nilai?(n=oldNominal-t,$("#totalNilaiPembiayaan"+a.data.unit_id).html(formatRupiah(e-n)).attr("data-total",e-n)):oldNominal<t&&(n=a.data.nilai-oldNominal,$("#totalNilaiPembiayaan"+a.data.unit_id).html(formatRupiah(e+n)).attr("data-total",e+n)),$("#itemPembiayaan"+a.data.id).attr("onclick","editItemPembiayaan("+a.data.id+", "+t+", event)").text(formatRupiah(t)),$("#totalPembiayaan").text(formatRupiah(a.totalPembiayaan)),totalPembiayaan=a.totalPembiayaan)):errorSwal("Gagal mengubah nominal.")},error:function(a){errorSwal(a.responseJSON.message)}},"json")}),$("#belanja-tab").on("click",function(a){a.preventDefault(),$("#pendapatanSatatusText").show(),$("#statusSumberDana").text("Sisa").show(),$("#belanjaStatusText").show(),$("#pembiayaanStatusText").show(),$("#belanjaContentTable").html(""),$("#noDataBelanja").hide(),$("#itemKertasKerjaBelanjaLoader").html("").append('<div class="d-flex justify-content-center"><div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div></div>'),$("#btnTambahPendapatan").hide(),$("#btnTambahPembiayaan").hide(),fetchKertasKerjaBelanja(tanggalIDKertasKerja)}),$("#btnTambahBelanja").on("click",function(){$("#modalFormBelanja").text("Form Tambah Kertas Kerja Belanja"),$("#formItemBelanja").trigger("reset"),$("#nilaiWarning").hide(),$("#pembiayaanWarning").hide(),$("#tanggalId").val(tanggalIDKertasKerja),$("#belanjaTotalPendapatan").val(totalPendapatan),$("#modalItemBelanjan").modal("show")}),$("#nilaiBelanja").keyup(function(){var a=$("#nilaiBelanja").val(),t=(a=(a=a.replace(/\./g,"")).replace(/\,/g,"."))-totalPendapatan;a>totalPendapatan?($("#nilaiWarning").show(),$("#btnSimpanItemBelanja").hide(),$("#pembiayaanCheckbox").removeAttr("disabled"),$("#pembiayaanCheckbox").is(":checked")?(t>totalPembiayaan?$("#pembiayaanWarning").show():($("#pembiayaanWarning").hide(),$("#btnSimpanItemBelanja").show()),$("#rekeningBelanjaPembiayaan").removeAttr("disabled")):($("#btnSimpanItemBelanja").hide(),$("#rekeningBelanjaPembiayaan").attr("disabled",!0))):($("#nilaiWarning").hide(),$("#btnSimpanItemBelanja").show(),$("#pembiayaanCheckbox").attr("disabled",!0),$("#pembiayaanWarning").hide())}),$("#pembiayaanCheckbox").on("click",function(){var a=$("#nilaiBelanja").val(),t=(a=(a=a.replace(/\./g,"")).replace(/\,/g,"."))-totalPendapatan;$(this).is(":checked")?(t>totalPembiayaan?($("#btnSimpanItemBelanja").hide(),$("#pembiayaanWarning").show()):($("#btnSimpanItemBelanja").show(),$("#pembiayaanWarning").hide()),$("#rekeningBelanjaPembiayaan").removeAttr("disabled")):($("#btnSimpanItemBelanja").hide(),$("#rekeningBelanjaPembiayaan").attr("disabled",!0))}),$("#btnSimpanItemBelanja").on("click",function(a){a.preventDefault();formatBelanja.unformat();$("#nilaiBelanja").val();$.ajax({type:"POST",url:pendapatanUrl+"store-belanja",dataType:"json",data:$("#formItemBelanja").serialize(),success:function(a){var t="";$("#itemKertasKerjaBelanjaLoader").html(""),a.status?($("#totalSumberDana").text(formatRupiah(a.totalSumberDana)).show(),totalPendapatan=a.totalSumberDana,$("#totalBelanja").text(formatRupiah(a.totalBelanja)).show(),totalBelanja=a.totalBelanja,$("#totalPembiayaan").text(formatRupiah(a.totalPembiayaan)).show(),totalPembiayaan=a.totalPembiayaan,$("#belanjaContentTable").children().length>0?($("#opdBelanja"+a.data.unit_id).children().length>0?(t="",t+="<tr>",t+='<td style="width: 80%">'+a.data.uraian+"</td>",t+='<td style="text-align: end; width: 20%; padding-right: 0.5rem !important;"><a href="#" class="text-dark nominal" onclick="editItemBelanja('+a.data.id+", "+a.data.nilai+","+a.data.pembiayaan_id+","+a.data.nilai_pembiayaan+',  event)">'+formatRupiah(a.data.nilai)+"</a></td>",t+="</tr>",$("#tblOpdBelanja"+a.data.unit_id).append(t),newTotal=parseInt($("#totalNilaiBelanja"+a.data.unit_id).data("total"+a.data.unit_id))+parseInt(a.data.nilai),$("#totalNilaiBelanja"+a.data.unit_id).html(formatRupiah(newTotal)).attr("data-total"+a.data.unit_id,newTotal)):(t="",t+='<table class="w-100 table table-sm mb-0">',t+="<thead>",t+="<tr>",t+="<th>Uraian</th>",t+="<th>Nilai</th>",t+="</tr>",t+="</thead>",t+='<tbody id="tblOpdBelanja'+a.data.unit_id+'">',t+="<tr>",t+='<td style="width: 80%">'+a.data.uraian+"</td>",t+='<td style="text-align: end; width: 20%; padding-right: 0.5rem !important;"><a href="#" class="text-dark nominal" id="itemBelanja'+a.data.id+'" onclick="editItemBelanja('+a.data.id+", "+a.data.nilai+","+a.data.pembiayaan_id+", "+a.data.nilai_pembiayaan+',event)">'+formatRupiah(a.data.nilai)+"</a></td>",t+="</tr>",t+="</tbody>",t+="</table>",$("#opdBelanja"+a.data.unit_id).html(t),$("#totalNilaiBelanja"+a.data.unit_id).html("Rp. "+formatRupiah(a.data.nilai)).attr("data-total"+a.data.unit_id,a.data.nilai)),$("#modalItemBelanjan").modal("hide")):fetchKertasKerjaBelanja(tanggalIDKertasKerja),$("#modalItemBelanjan").modal("hide"),successSwal("Berhsail")):errorSwal("Terdapat inputan yang masih kosong.")}})}),$("#pembiayaan-tab").on("click",function(a){a.preventDefault(),$("#pendapatanSatatusText").hide(),$("#belanjaStatusText").hide(),$("#pembiayaanStatusText").show(),$("#pembiayaanContentTable").html(""),$("#noDataPembiayaan").hide(),$("#itemKertasKerjaPembiayaanLoader").html("").append('<div class="d-flex justify-content-center"><div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div></div>'),fetchKertasKerjaPembiayaan(tanggalIDKertasKerja)}),$("#btnTambahPembiayaan").on("click",function(){$("#modalFormItemPembiayaan").text("Form Tambah Kertas Kerja Pembiayaan"),$("#pembiayaanTanggalId").val(tanggalIDKertasKerja),$("#formItemPembiayaan").trigger("reset"),$("#modalItemPembiayaan").modal("show")}),$("#btnSimpanItemPembiayaan").on("click",function(a){a.preventDefault();formatPembiayaan.unformat(),$.ajax({type:"POST",url:pendapatanUrl+"store-pembiayaan",dataType:"json",data:$("#formItemPembiayaan").serialize(),success:function(a){var t="";a.status&&($("#pembiayaanContentTable").children().length>0?($("#opdPembiayaan"+a.data.unit_id).children().length>0?(t="",t+="<tr>",t+='<td style="width: 80%">'+a.data.uraian+"</td>",t+='<td style="text-align: end; width: 20%; padding-right: 0.5rem !important;"><a href="#" class="text-dark nominal" onclick="editItemPembiayaan('+a.data.id+", "+a.data.nilai+', event)">'+formatRupiah(a.data.nilai)+"</a></td>",t+="</tr>",$("#tblOpdPembiayaan"+a.data.unit_id).append(t),newTotal=parseInt($("#totalNilaiPembiayaan"+a.data.unit_id).data("total"+a.data.unit_id))+parseInt(a.data.nilai),$("#totalNilaiPembiayaan"+a.data.unit_id).html(formatRupiah(newTotal)).attr("data-total"+a.data.unit_id,newTotal),$("#totalPembiayaan").text(formatRupiah(a.totalPembiayaan)),totalPembiayaan=a.totalPembiayaan):(t="",t+='<table class="w-100 table table-sm mb-0">',t+="<thead>",t+="<tr>",t+="<th>Uraian</th>",t+="<th>Nilai</th>",t+="</tr>",t+="</thead>",t+='<tbody id="tblOpdPembiayaan'+a.data.unit_id+'">',t+="<tr>",t+='<td style="width: 80%">'+a.data.uraian+"</td>",t+='<td style="text-align: end; width: 20%; padding-right: 0.5rem !important;"><a href="#" class="text-dark nominal" id="itemPembiayaan'+a.data.id+'" onclick="editItemPembiayaan('+a.data.id+", "+a.data.nilai+', event)">'+formatRupiah(a.data.nilai)+"</a></td>",t+="</tr>",t+="</tbody>",t+="</table>",$("#opdPembiayaan"+a.data.unit_id).html(t),$("#totalNilaiPembiayaan"+a.data.unit_id).html("Rp. "+formatRupiah(a.data.nilai)).attr("data-total"+a.data.unit_id,a.data.nilai),$("#totalPembiayaan").text(formatRupiah(a.totalPembiayaan)),totalPembiayaan=a.totalPembiayaan),$("#modalItemPembiayaan").modal("hide")):fetchKertasKerjaPembiayaan(tanggalIDKertasKerja),$("#modalItemPembiayaan").modal("hide"),successSwal("Berhsail"))}})});
